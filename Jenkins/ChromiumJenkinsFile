// Describes a new stage, stages are executed in the order in which they are declared
// so this currently executes as the fourth stage
stage("vmagent_build") {
   // Providing a string argument to node() causes the steps inside to be executed on
   // machines of a given label. This is currently configured to be a VisualStudio2017
   // VM allocated on Azure
   node("azwinvs") {
      bat 'cd /d %SYSTEMDRIVE%\\EdgeCI\\src & dir /a:d'
   }
}

// This stage doesn't run until after the build stage above
stage("vmagent_test") {
  // This stage runs on a different label - test VMs
  node("azwintest") {
    // unpack the stashed results ('tests') and run them
    //unstash name:'tests'
    //bat 'hello.exe'
    bat 'echo foobar'
  }
}
